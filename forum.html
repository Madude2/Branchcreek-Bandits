<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forum - Branchcreek Bandits</title>

  <!-- Tailwind + Fonts + Icons -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.cdnfonts.com/css/western" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

  <style>
    .nav-link { color: white; }
    .nav-link:hover { color: #d4a017; }
    .western-text { font-family: 'Western', sans-serif; }
    .forum-post { background:white; padding:1.5rem; border-radius:0.5rem; transition:0.3s; }
    .forum-post:hover { box-shadow:0 4px 6px rgba(0,0,0,0.1); transform:translateY(-2px); }
    #forum-content { display:none; }
    input, button { border-radius:0 !important; }
  </style>
</head>

<body class="bg-gray-100 font-sans flex flex-col min-h-screen">

  <!-- Dynamic Navbar -->
  <div id="navbar"></div>

  <!-- Main content -->
  <div class="flex-grow">
    <section class="py-16">
      <div class="container mx-auto px-6 max-w-5xl">
        <h1 class="western-text text-5xl mb-6 text-center">Forum</h1>

        <div id="login-warning" class="text-center text-red-500 mb-6">
          Du skal v√¶re logget ind og v√¶re verificeret af en administrator for at bruge forummet.
        
        </div>

        
        <div id="forum-content">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="forum-post">
              <h3 class="text-xl font-bold mb-2">Velkommen!</h3>
              <p>Dette er forumet, hvor alle medlemmer kan diskutere Western Shooting.</p>
            </div>
            <div class="forum-post">
              <h3 class="text-xl font-bold mb-2">Nyt skydest√¶vne</h3>
              <p>Del dine oplevelser fra det seneste skydest√¶vne her.</p>
            </div>
          </div>
        </div>

      </div>
    </section>
  </div>

  <!-- Dynamic Footer -->
  <div id="footer"></div>

  <!-- -------- includeHTML helper -------- -->
  <script>
  async function includeHTML(file, elementId, callback){
    try {
      const res = await fetch(file);
      const html = await res.text();
      const mount = document.getElementById(elementId);
      mount.innerHTML = html;

      // Re-run any <script> tags from the injected HTML
      const scripts = mount.querySelectorAll("script");
      for (const oldScript of scripts) {
        const s = document.createElement("script");
        for (const attr of oldScript.attributes) s.setAttribute(attr.name, attr.value);
        if (!oldScript.src) s.textContent = oldScript.textContent;
        document.body.appendChild(s);
      }

      if (window.feather) feather.replace();
      if (callback) callback();
    } catch (err) {
      console.error("includeHTML error:", err);
    }
  }
  </script>

  <!-- -------- Forum visibility controls (updated) -------- -->
<script type="module">
import { auth, db } from "./js/firebase.js";
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const ADMIN_EMAIL = "asbjrnahle33@gmail.com";

// ‚úÖ Utility: show/hide forum sections
function unlockForum() {
  const f = document.getElementById("forum-content");
  const w = document.getElementById("login-warning");
  if (f && w) {
    f.style.display = "block";
    w.style.display = "none";
  }
}

function lockForum() {
  const f = document.getElementById("forum-content");
  const w = document.getElementById("login-warning");
  if (f && w) {
    f.style.display = "none";
    w.style.display = "block";
  }
}

// ‚úÖ Main listener: checks if user is verified or admin
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    lockForum();
    return;
  }

  try {
    const userRef = doc(db, "users", user.uid);
    const userSnap = await getDoc(userRef);
    const data = userSnap.exists() ? userSnap.data() : {};
    const isAdmin = user.email === ADMIN_EMAIL;
    const isVerified = isAdmin || data.verifiedByAdmin || data.role === "verified";

    if (isVerified) {
      unlockForum();
    } else {
      lockForum();
    }
  } catch (err) {
    console.error("‚ùå Fejl ved kontrol af brugerstatus:", err);
    lockForum();
  }
});

// ‚úÖ Make them globally available in case auth.js calls them
window.lockForum = lockForum;
window.unlockForum = unlockForum;
</script>


  <!-- -------- Load Navbar + Footer -------- -->
  <script>
  includeHTML("nav.html", "navbar", () => {
    // K√∏r auth.js efter nav eksisterer
    if (typeof setupAuth === "function") setupAuth();

    // Menu toggles
    const menuBtn=document.getElementById('menu-btn');
    const mobileMenu=document.getElementById('mobile-menu');
    if(menuBtn && mobileMenu) menuBtn.addEventListener('click',()=>mobileMenu.classList.toggle('hidden'));

    const loginBtn=document.getElementById('login-btn');
    const loginDropdown=document.getElementById('login-dropdown');
    if(loginBtn && loginDropdown) loginBtn.addEventListener('click',()=>loginDropdown.classList.toggle('hidden'));

    const mobileLoginBtn=document.getElementById('mobile-login-btn');
    const mobileLoginForm=document.getElementById('mobile-login-form');
    if(mobileLoginBtn && mobileLoginForm) mobileLoginBtn.addEventListener('click',()=>mobileLoginForm.classList.toggle('hidden'));

    // üîî Force refresh of notifications after nav loads
    setTimeout(() => {
      if (typeof window.refreshNotificationsBadge === "function") {
        window.refreshNotificationsBadge();
      }
    }, 1200); // vent lidt for auth+nav at loade
  });

  includeHTML("footer.html", "footer");
  </script>

  <!-- Shared Scripts -->
  <script type="module" src="js/firebase.js"></script>
<script type="module" src="js/auth.js"></script>
<script type="module" src="js/common.js"></script>


</body>
</html>
