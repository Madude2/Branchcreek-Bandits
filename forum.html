<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Brachcreek Bandits Forum - Threads</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
<link href="https://fonts.cdnfonts.com/css/western" rel="stylesheet">

<style>
  .nav-link:hover { color: #d4a017; }
  .western-text { font-family: 'Western', sans-serif; }
</style>
</head>
<body class="bg-gray-100 font-sans">

<!-- Navigation -->
<nav class="bg-black text-white shadow-lg">
  <div class="container mx-auto px-8 py-8 flex justify-between items-center">
    <a href="index.html" class="flex items-center space-x-4">
      <span class="western-text text-3xl md:text-5xl">Branchcreek Bandits</span>
    </a>

    <div class="hidden md:flex items-center space-x-8">
      <a href="about.html" class="nav-link font-medium">Information</a>
      <a href="events.html" class="nav-link font-medium">Begivenheder</a>
      <a href="gallery.html" class="nav-link font-medium">Galleri</a>
      <a href="forum.html" class="nav-link font-medium font-bold text-yellow-400">Forum</a>
      <a href="contact.html" class="nav-link font-medium">Kontakt</a>

      <div class="relative">
        <button id="login-btn" class="nav-link font-medium flex items-center space-x-1">
          <span>Login</span>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>
        <div id="login-dropdown" class="absolute right-0 mt-2 w-64 bg-white text-black shadow-lg p-4 hidden z-50">
          <h3 class="font-bold mb-2">Login</h3>
          <input type="email" id="login-email" placeholder="Email" class="w-full mb-2 px-3 py-2 border">
          <input type="password" id="login-password" placeholder="Password" class="w-full mb-2 px-3 py-2 border">
          <button onclick="login(document.getElementById('login-email').value, document.getElementById('login-password').value)" class="w-full bg-yellow-600 hover:bg-yellow-700 py-2 font-bold mb-2">Login</button>
          <a href="signup.html" class="text-blue-600 hover:underline block text-center">Opret Konto</a>
        </div>
      </div>

      <button id="logout-btn" onclick="logout()" class="ml-2 text-red-500 font-bold hidden">Log ud</button>
    </div>

    <button id="menu-btn" class="md:hidden focus:outline-none"><i data-feather="menu"></i></button>
  </div>

  <div id="mobile-menu" class="hidden md:hidden bg-black text-white px-8 pb-6">
    <a href="about.html" class="block py-2 nav-link">Information</a>
    <a href="events.html" class="block py-2 nav-link">Begivenheder</a>
    <a href="gallery.html" class="block py-2 nav-link">Galleri</a>
    <a href="forum.html" class="block py-2 nav-link font-bold text-yellow-400">Forum</a>
    <a href="contact.html" class="block py-2 nav-link">Kontakt</a>
  </div>
</nav>

<!-- Forum Header -->
<section class="bg-gray-800 text-white py-16">
  <div class="container mx-auto px-6 text-center">
    <h1 class="western-text text-4xl md:text-5xl font-bold mb-6">Forum Threads</h1>
    <p class="text-xl mb-8">Browse and create threads to discuss Western Shooting and events.</p>
    <div id="user-info" class="text-lg mb-4"></div>
    <button id="new-thread-btn" class="bg-yellow-600 hover:bg-yellow-700 py-2 px-4 font-bold rounded hidden mb-4">Opret Ny Tråd</button>
  </div>
</section>

<!-- Threads Section -->
<section class="py-12">
  <div class="container mx-auto px-6 max-w-4xl">
    <div id="thread-form" class="hidden mb-6 bg-white p-6 rounded-lg shadow">
      <h2 class="text-2xl font-bold mb-4">Ny Tråd</h2>
      <input id="thread-title" class="w-full mb-2 px-3 py-2 border" placeholder="Tråd Titel">
      <textarea id="thread-body" class="w-full mb-2 px-3 py-2 border" placeholder="Indledende indlæg"></textarea>
      <button onclick="createThread()" class="bg-yellow-600 hover:bg-yellow-700 py-2 px-4 font-bold text-white rounded">Opret Tråd</button>
    </div>

    <div id="threads-container"></div>
  </div>
</section>

<!-- Footer -->
<footer class="bg-black text-white py-12">
  <div class="container mx-auto px-6">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
      <div>
        <h3 class="text-xl font-bold mb-4">Brachcreek Bandits</h3>
        <p class="text-gray-400">Preserving the spirit of the Old West through Cowboy Action Shooting since 2005.</p>
      </div>
      <div></div>
      <div>
        <h3 class="text-xl font-bold mb-4">Contact</h3>
        <ul class="space-y-2 text-gray-400">
          <li class="flex items-center"><i data-feather="mail" class="mr-2"></i> contact@brachcreekbandits.com</li>
          <li class="flex items-center"><i data-feather="phone" class="mr-2"></i> (555) 123-4567</li>
          <li class="flex items-center"><i data-feather="map-pin" class="mr-2"></i> Brach Creek, TX</li>
        </ul>
      </div>
      <div></div>
    </div>
  </div>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

// Firebase
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Elements
const userInfo = document.getElementById("user-info");
const logoutBtn = document.getElementById("logout-btn");
const newThreadBtn = document.getElementById("new-thread-btn");
const threadForm = document.getElementById("thread-form");
const threadsContainer = document.getElementById("threads-container");

// Login function
window.login = function(email, password) {
  if(email === "veenkate0@gmail.com" && password === "tzw85unb") {
    updateMenu("Kate Veen");
    return;
  }
  if(firebaseConfig.apiKey !== "YOUR_API_KEY") {
    signInWithEmailAndPassword(auth, email, password)
      .then(userCredential => updateMenu(userCredential.user.displayName || userCredential.user.email))
      .catch(err => alert("Firebase login failed: " + err.message));
  } else {
    alert("Firebase not configured. Kate Veen test login works for testing.");
  }
}

function updateMenu(name) {
  userInfo.innerText = `Velkommen, ${name}`;
  logoutBtn.classList.remove("hidden");
  newThreadBtn.classList.remove("hidden");
  threadForm.classList.add("hidden");
}

// Logout
window.logout = function() {
  userInfo.innerText = "";
  logoutBtn.classList.add("hidden");
  newThreadBtn.classList.add("hidden");
  threadForm.classList.add("hidden");
  if(firebaseConfig.apiKey !== "YOUR_API_KEY") signOut(auth).catch(err => console.error(err.message));
}

// Persistent login
onAuthStateChanged(auth, user => {
  if(user) updateMenu(user.displayName || user.email);
});

// Show thread form
newThreadBtn.addEventListener("click", () => {
  threadForm.classList.toggle("hidden");
});

// Create thread
window.createThread = async function() {
  const title = document.getElementById("thread-title").value.trim();
  const body = document.getElementById("thread-body").value.trim();
  if(!title || !body) return alert("Titel og indhold kræves");

  await addDoc(collection(db, "threads"), {
    title,
    body,
    author: auth.currentUser ? (auth.currentUser.displayName || auth.currentUser.email) : "Kate Veen",
    timestamp: serverTimestamp()
  });

  document.getElementById("thread-title").value = "";
  document.getElementById("thread-body").value = "";
  threadForm.classList.add("hidden");
}

// Load threads
const q = query(collection(db, "threads"), orderBy("timestamp", "desc"));
onSnapshot(q, snapshot => {
  threadsContainer.innerHTML = "";
  snapshot.forEach(doc => {
    const data = doc.data();
    const div = document.createElement("div");
    div.className = "bg-white p-4 rounded-lg shadow mb-4";
    div.innerHTML = `
      <h3 class="font-bold text-xl">${data.title}</h3>
      <p class="text-gray-700 mb-1">${data.body}</p>
      <p class="text-gray-400 text-sm">By ${data.author}</p>
      <a href="thread.html?id=${doc.id}" class="text-blue-600 hover:underline">Se tråd & svar</a>
    `;
    threadsContainer.appendChild(div);
  });
});
</script>

<script>
const menuBtn = document.getElementById('menu-btn');
const mobileMenu = document.getElementById('mobile-menu');
menuBtn.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));

const loginBtn = document.getElementById('login-btn');
const loginDropdown = document.getElementById('login-dropdown');
loginBtn.addEventListener('click', () => loginDropdown.classList.toggle('hidden'));

feather.replace();
</script>
</body>
</html>
